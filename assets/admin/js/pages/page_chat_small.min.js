var $chatbox_wrapper=$("#chatbox_wrapper");$(function(){$body.addClass("sidebar_secondary_active sidebar_secondary_persisten"),altair_chat_alt.chat_list(),altair_chat_alt.chatboxes()}),altair_chat_alt={chat_list:function(){var r=$("#chatbox_template").html();$("#chatboxes").on("click","> li",function(){var e=$(this);if(!e.hasClass("chatbox_active")){e.addClass("chatbox_active");var t={username:$(this).attr("data-user"),conversation:[{avatarUrl:"assets/img/avatars/"+$(this).attr("data-user-avatar")+"_tn.png",messages:[{time:1473940165e3,text:"lorem ipsum dolor sit amet..."},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{own:!0,messages:[{time:1473940165e3,text:"Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit."}]}]},a=Handlebars.compile(r);Handlebars.registerPartial("conversation",$("#chatbox_conversation").html()),Handlebars.registerPartial("messages",$("#chatbox_messages").html());var s=a(t);$chatbox_wrapper.prepend(s);var i=$chatbox_wrapper.children(".chatbox:first-child"),c=i.find(".chatbox_content");c.scrollTop(c[0].scrollHeight);var o=$chatbox_wrapper.find(".message_input");autosize(o),o.on("autosize:resized",function(){i.css({"padding-bottom":o.outerHeight()})}),window.matchMedia("(max-width: 767px)").matches&&altair_secondary_sidebar.hide_sidebar()}})},chatboxes:function(){$chatbox_wrapper.on("mousewheel DOMMouseScroll",".chatbox_content",function(e){var t=e.originalEvent,a=t.wheelDelta||-t.detail;this.scrollTop+=30*(a<0?1:-1),e.preventDefault()}),$chatbox_wrapper.on("click",".chatbox",function(e){if(e.preventDefault(),!$(e.target).closest(".chatbox_close").length){$chatbox_wrapper.find(".cb_active").not($(this)).removeClass("cb_active");var t=$(this);t.hasClass("cb_active")||(t.addClass("cb_active"),$(e.target).closest(".actions_dropdown").length||t.find(".message_input").focus())}}),$document.on("click",function(e){$(e.target).closest(".chatbox").length||$chatbox_wrapper.find(".cb_active").removeClass("cb_active")}),$chatbox_wrapper.on("click",".chatbox_close",function(e){e.preventDefault();var t=$(this).closest(".chatbox").addClass("removing"),a=t.attr("data-user");setTimeout(function(){$("#chatboxes").children('li[data-user="'+a+'"]').removeClass("chatbox_active"),t.remove()},280)}),$chatbox_wrapper.on("keyup",".message_input",function(e){var t=$(this);if(e.preventDefault(),13==(e.keyCode||e.which)&&""!=t.val()){var a=$(this).closest(".chatbox").find(".chatbox_content"),s=Handlebars.compile($("#chatbox_conversation").html());messages_template=Handlebars.compile($("#chatbox_messages").html());var i={conversation:[{own:!0,messages:[{time:(new Date).getTime(),text:t.val()}]}]},c=s(i),o=messages_template(i.conversation[0]);a.children(".chatbox_message:last-child").hasClass("own")?a.children(".chatbox_message:last-child").children("ul").append(o):a.append(c),$(this).val(""),a.scrollTop(a[0].scrollHeight)}})}};